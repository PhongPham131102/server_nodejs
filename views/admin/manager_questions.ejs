<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" type="image/png" href="/images/logoapp.png" />
    <link rel="stylesheet" href="/stylesheets/admincss.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <link href="https://fonts.cdnfonts.com/css/be-vietnam-pro" rel="stylesheet">
    <title>Quản Lý Câu Hỏi</title>
</head>

<body>
    <div class="lds-ring">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
    <div class="container__main">
        <div class="container__sidebar">
            <div class="sidebar__logo">
                <img src="/images/admin/logo.png" alt="">
            </div>
            <hr>
            <div class="sidebar-item">
                <div class="sideabar__top">
                    <a href="/admin/manageraccount">
                        Quản lý tài khoản
                    </a>
                    <a href="/admin/managerquestions" class="active">
                        Quản lý câu hỏi
                    </a>
                    <div class="logout">
                        Đăng Xuất
                    </div>
                </div>
            </div>

        </div>
        <div class="container__content">
            <header class="content__header">
                <div class="content__header__nav">
                    <div class="content__header__none"></div>
                    <div class="content-info">
                        <div class="content__header__info">
                            <p class="content__info__username">
                                <%=user.fullName%>
                            </p>
                            <p class="content__info__decentralization">Admin</p>
                        </div>
                        <img src="/images/user.png" class="content__avt" />
                    </div>
                </div>
            </header>
            <div class="content__content">
                <div class="content__button__wrapper">
                    <div class="search__box">
                        <input name="search_question" type="text" placeholder="Nhập tiêu đề câu hỏi để tìm kiếm">
                        <button class="search">
                            <img src="/images/admin/search.png" alt="">
                        </button>
                    </div>

                    <div class="option">
                        <div class="language__option">
                            <select id="language_select">
                                <option value="">Ngôn Ngữ</option>
                                <% typeLanguageLevels.forEach((typeLanguageLevel) => { %>
                                    <option value=<%= typeLanguageLevel.typeLanguage %>><%= typeLanguageLevel.typeLanguage.toUpperCase() %></option>
                                  <% }) %>
                            </select>
                        </div>
                        <div class="language__option">
                            <select id="level_select">
                                <option value="">Level</option>
                            </select>
                        </div>
                    </div>

                    <div class="content__button">
                        <button class="button__add_acc" id="add_ques">Thêm Mới</button>
                    </div>
                </div>

                <div class="content__table">
                    <div class="content__table__title">
                        <ul class="list__title">
                            <li>STT</li>
                            <li>Tiêu Đề</li>
                            <li>Ngôn Ngữ</li>
                            <li>Level</li>
                            <li>Thao Tác</li>
                        </ul>
                    </div>
                    <%index=0%>
                        <% questions.forEach(question => { %>
                            <%index++%>
                                <div class="content__table__item list__question" data-typelanguage="<%=question.typeLanguage%>" data-level="<%=question.level%>">
                                    <ul class="list__item">
                                        <li class="id_question" style="display: none;">
                                            <%=question._id%>
                                        </li>
                                        <li class="answer" style="display: none;">
                                            <%=JSON.stringify(question.answers)%>
                                        </li>
                                        <li class="time" style="display: none;">
                                            <%=question.time%>
                                        </li>
                                        <li class="score" style="display: none;">
                                            <%=question.score%>
                                        </li>
                                        <li>
                                            <%=index%>
                                        </li>
                                        <li class="title">
                                            <%=question.title%>

                                        </li>
                                        <li class="typelanguage">
                                            <%=question.typeLanguage%>
                                        </li>
                                        <li class="level">
                                            <%=question.level%>
                                        </li>
                                        <li class="item__option">
                                            <button class="button__edit" id="edit_info">Chỉnh Sửa</button>
                                            <button style="background-color: rgb(157, 4, 4);" class="button__del" id="msg_del">Xóa</button>
                                        </li>
                                    </ul>
                                </div>
                                <% }) %>
                </div>

                <!-- THÊM MỚI -->



            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
        <script>
            $(document).ready(function() {
                $('.logout').click(function() {
                    $.removeCookie('accessToken');
                    $.removeCookie('userId');
                    window.location.href = '/admin';
                });
                var token = $.cookie("accessToken");
                var selectedLanguageObject = "";
                var selectedLevelObject = "";
                var Question = {
                    title: "",
                    typeLanguage: "",
                    level: "",
                    typeQuestion: "one_choice",
                    answers: [{
                        answerText: "",
                        score: false,
                    }, {
                        answerText: "",
                        score: false,
                    }, {
                        answerText: "",
                        score: false,
                    }, {
                        answerText: "",
                        score: false,
                    }, ],
                    score: 10,
                    time: 10,
                };

                $("#add_ques").on("click", function() {
                    Question.title = "";
                    Question.typeLanguage = "";
                    Question.level = "";
                    Question.score = 10;
                    Question.time = 10;
                    for (let i = 0; i < Question.answers.length; i++) {
                        Question.answers[i].answerText = "";
                        Question.answers[i].score = false;
                    }
                    var selectedLanguageObjectToAddQuestion = "";
                    var selectedLevelObjectToAddQuestion = "";

                    $(".content__content").append(`<div id="wrapper__popup__add__quesion" class="open__popup">
                    <div id="popup__add__quesion">
                        <div class="popup__title__info">
                            <div></div>
                            <p>Thêm Mới Câu Hỏi</p>
                            <button class="close__msg" id="exit_add_question"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                        <div class="popup__content__info">
                            <div class="info__detail__ques__1">
                                <label for="">Tiêu đề: </label>
                                <input name="title_question" type="text" placeholder="Nội dung câu hỏi">
                            </div>
                            <div class="info__detail__ques__1">
                                <label for="">Ngôn Ngữ: </label>
                                <div class="language__option">
                                    <select id="language_select_on_add">
                                        <option value="">Ngôn Ngữ</option>
                                        <% typeLanguageLevels.forEach((typeLanguageLevel) => { %>
                                            <option value=<%= typeLanguageLevel.typeLanguage %>><%= typeLanguageLevel.typeLanguage.toUpperCase() %></option>
                                          <% }) %>
                                    </select>
                                </div>
                            </div>

                            <div class="info__detail__ques__1">
                                <label for="">Cấp độ: </label>
                                <div class="language__option">
                                    <select id="level_select_on_add">
                                    <option value="">Level</option>
                                </select>
                                </div>
                            </div>
                            <div class="info__detail__ques__1">
                                <label for="">Đáp Án: </label>
                                <div class="answer">
                                    <div class="answer__1">
                                        <div class="ans_1">
                                            <input type="text" name="answer" placeholder="Nội dung câu hỏi">
                                            <input type="radio" name="score_answer">
                                        </div>

                                        <div class="ans_1">
                                            <input type="text" name="answer" placeholder="Nội dung câu hỏi">
                                            <input type="radio" name="score_answer">
                                        </div>
                                    </div>
                                    <div class="answer__1">
                                        <div class="ans_1">
                                            <input type="text" name="answer" placeholder="Nội dung câu hỏi">
                                            <input type="radio" name="score_answer">
                                        </div>

                                        <div class="ans_1">
                                            <input type="text" name="answer" placeholder="Nội dung câu hỏi">
                                            <input type="radio" name="score_answer">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="set__options">
                                <div class="info__detail__ques__1">
                                    <label for="">Điểm số </label>
                                    <input type="text" value="10" name="score" class="level">

                                </div>
                                <div class="info__detail__ques__1">
                                    <label for="">Thời gian: </label>
                                    <input type="text" value="10" name="time" class="level">
                                    <div class="time">
                                        <p class="level__text">Tính theo giây(s)</p>
                                        <p class="level__text">Mặc định 10 giây</p>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: row; width: 100%; justify-content: end; align-items: center;">
                                <p class="validate_add_question" style="margin: 0; align-items: end;  padding-left: 10px; display: none; flex-direction: column; justify-content: flex-end; font-weight: 700;font-size: 1.3em; color: red;">
                                </p>
                                <div class="button__op1" style="margin: 0 !important;">

                                    <button id="update" class="add_question">Thêm Mới</button>
                                    <button class="cancel" id="exit_add_question1">Hủy</button>
                                </div>
                            </div>


                        </div>

                    </div>
                </div>`);
                    $("#exit_add_question").on("click", function() {
                        $(".content__content").children().last().remove();
                    });
                    $("#exit_add_question1").on("click", function() {
                        $(".content__content").children().last().remove();
                    });
                    //sự kiện thêm câu hỏi
                    $(".add_question").on("click", function() {
                        Question.typeLanguage = selectedLanguageObjectToAddQuestion;
                        Question.level = selectedLevelObjectToAddQuestion;
                        var validate = "";
                        if (Question.title == "") {
                            validate += "thiếu tiêu đề câu hỏi";
                        }
                        if (Question.typeLanguage == "") {
                            if (validate != "")
                                validate += ", ";
                            validate += "chưa chọn loại ngôn ngữ";
                        }
                        if (Question.level == "") {
                            if (validate != "")
                                validate += ", ";
                            validate += "chưa chọn cấp độ";
                        }
                        var hasCorrectAnswer = Question.answers.some(function(answer) {
                            return answer.score == true;
                        });

                        if (!hasCorrectAnswer) {
                            if (validate != "")
                                validate += ", ";
                            validate += "chưa chọn đáp án đúng";
                        }
                        var hasEmptyAnswer = Question.answers.some(function(answer) {
                            return answer.answerText === "";
                        });

                        if (hasEmptyAnswer) {
                            if (validate != "")
                                validate += ", ";
                            validate += "hãy nhập nội dung cho tất cả câu trả lời";
                        }
                        if (validate != "") {
                            validate += ".";
                            $(".validate_add_question").css("display", "flex");
                            $(".validate_add_question").text(validate);
                            setTimeout(function() {
                                $(".validate_add_question").css("display", "none");
                            }, 2000);
                        } else {
                            $(".content__content").children().last().remove();
                            $(".content__content").append(`
                <div id="wrapper__popup__accept" class="open__popup">
                    <div id="popup__accept">
                        <div class="popup__title">
                            <img src="/images/admin/yes.png" alt="">
                            <p>Thông Báo </p>
                        </div>
                        <div class="popup__content">
                            <p>Thêm Mới Thành Công!</p>
                           
                        </div>
                    </div>
                </div>`);
                            setTimeout(function() {
                                $(".content__content").children().last().remove();
                            }, 1000);
                            $(".lds-ring").css("display", "flex");
                            $.ajax({
                                url: "/api/questions/create",
                                type: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                    Authorization: `Bearer ${token}`,
                                },
                                data: JSON.stringify(Question),
                                success: function(response) {
                                    $(".lds-ring").css("display", "none");

                                    var length = $(".list__question").length;
                                    $(".content__table").append(`<div class="content__table__item list__question" data-typelanguage="${response.data.typeLanguage}" data-level="${response.data.level}">
                                    <ul class="list__item">
                                        <li class="id_question" style="display: none;">
                                            ${response.data._id}
                                        </li>
                                        <li class="answer" style="display: none;">
                                            ${JSON.stringify(response.data.answers)}
                                        </li>
                                        <li class="time" style="display: none;">
                                            ${response.data.time}
                                        </li>
                                        <li class="score" style="display: none;">
                                            ${response.data.score}
                                        </li>
                                        <li>
                                            ${length+1}
                                        </li>
                                        <li class="title">
                                            ${response.data.title}

                                        </li >
                                        <li class="typelanguage">
                                            ${response.data.typeLanguage}
                                        </li>
                                        <li class="level">
                                            ${response.data.level}
                                        </li>
                                        <li class="item__option">
                                            <button class="button__edit" >Chỉnh Sửa</button>
                                            <button style="background-color: rgb(157, 4, 4);" class="button__del" id="msg_del" >Xóa</button>
                                        </li>
                                    </ul>
                                </div>`);
                                },
                                error: function(err) {
                                    $(".lds-ring").css("display", "none");
                                },
                            });
                        }
                    });
                    $('input[name="title_question"]').on('blur', function(e) {
                        var inputValue = $(this).val();
                        Question.title = inputValue;
                    });

                    $('input[name="answer"]').each(function(index) {

                        $(this).on('blur', function(e) {
                            var updatedValue = $(this).val();
                            console.log(index);
                            console.log(Question.answers);
                            Question.answers[index].answerText = updatedValue;
                        });
                    });
                    $('input[name="score_answer"]').on('change', function(e) {
                        var isChecked = $(this).prop('checked');
                        var selectedIndex = $('input[name="score_answer"]').index(this);
                        console.log(selectedIndex);
                        $('input[name="score_answer"]').each(function(index) {
                            Question.answers[index].score = (index === selectedIndex) ? isChecked : false;
                        });
                    });
                    //chỉ cho nhập số vào input điểm số và giới hạn điểm số từ khoảng 10 đến 200
                    $('input[name="score"].level').on('blur', function(e) {
                        var inputValue = parseInt($(this).val());
                        // Xóa các ký tự không phải số
                        if (isNaN(inputValue)) {
                            inputValue = 10;
                            Question.score = 10;
                        } else {
                            // Kiểm tra giới hạn giá trị
                            inputValue = Math.min(Math.max(inputValue, 10), 200);
                            Question.score = inputValue;
                        }
                        $(this).val(inputValue);
                    });
                    //chỉ cho nhập số vào input thời gian và giới hạn thời gian từ khoảng 10 đến 180
                    $('input[name="time"]').on('blur', function(e) {
                        var inputValue = parseInt($(this).val());
                        // Xóa các ký tự không phải số
                        if (isNaN(inputValue)) {
                            inputValue = 10;
                            Question.time = 10;
                        } else {
                            // Kiểm tra giới hạn giá trị
                            inputValue = Math.min(Math.max(inputValue, 10), 180);
                            Question.time = inputValue;
                        }
                        $(this).val(inputValue);
                    });
                    //chọn cấp độ ở phần thêm câu hỏi
                    $('#level_select_on_add').change(function() {
                        var selectedLanguage = $(this).val();
                        selectedLevelObjectToAddQuestion = selectedLanguage;
                        console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                    });

                    //chọn ngôn ngữ
                    $('#language_select_on_add').change(function() {
                        var selectedLanguage = $(this).val();
                        var typeLanguageLevels = JSON.parse('<%- JSON.stringify(typeLanguageLevels) %>');
                        var selectedLevels = typeLanguageLevels.find(function(typeLanguageLevel) {
                            return typeLanguageLevel.typeLanguage == selectedLanguage;
                        });
                        if (selectedLevels) {
                            selectedLanguageObjectToAddQuestion = selectedLanguage;
                            selectedLevelObjectToAddQuestion = "1";
                            var levelSelect = $('#level_select_on_add');
                            levelSelect.empty();
                            console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                            // Thêm các option tương ứng với các level
                            selectedLevels.levels.forEach(function(level) {
                                levelSelect.append($('<option>', {
                                    value: level,
                                    text: level
                                }));
                            });
                        } else {
                            selectedLanguageObjectToAddQuestion = "";
                            selectedLevelObjectToAddQuestion = "";
                            var levelSelect = $('#level_select_on_add');
                            levelSelect.empty();
                            levelSelect.append($('<option>', {
                                value: "",
                                text: "Level"
                            }));
                            console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                        }
                    });
                });

                // Lắng nghe sự kiện thay đổi giá trị của input
                $("input[name='search_question']").on("input", function() {
                    filterQuestions();
                });
                //chọn cấp độ
                $('#level_select').change(function() {
                    var selectedLanguage = $(this).val();
                    selectedLevelObject = selectedLanguage;
                    console.log(selectedLanguageObject + "   " + selectedLevelObject);
                    filterQuestions();
                });

                //chọn ngôn ngữ
                $('#language_select').change(function() {
                    var selectedLanguage = $(this).val();
                    var typeLanguageLevels = JSON.parse('<%- JSON.stringify(typeLanguageLevels) %>');

                    // Lọc danh sách typeLanguageLevels để tìm các level tương ứng
                    var selectedLevels = typeLanguageLevels.find(function(typeLanguageLevel) {
                        return typeLanguageLevel.typeLanguage == selectedLanguage;
                    });
                    if (selectedLevels) {
                        selectedLanguageObject = selectedLanguage;
                        selectedLevelObject = "1";
                        var levelSelect = $('#level_select');
                        levelSelect.empty();
                        console.log(selectedLanguageObject + "   " + selectedLevelObject);
                        // Thêm các option tương ứng với các level
                        selectedLevels.levels.forEach(function(level) {
                            levelSelect.append($('<option>', {
                                value: level,
                                text: level
                            }));
                        });
                        filterQuestions();
                    } else {
                        selectedLanguageObject = "";
                        selectedLevelObject = "";
                        var levelSelect = $('#level_select');
                        levelSelect.empty();
                        levelSelect.append($('<option>', {
                            value: "",
                            text: "Level"
                        }));
                        console.log(selectedLanguageObject + "   " + selectedLevelObject);
                        filterQuestions();
                    }

                });
                // lọc câu hỏi
                function filterQuestions() {
                    var searchValue = $("input[name='search_question']").val().trim().toLowerCase();

                    $('.content__table__item').each(function() {
                        var typeLanguage = $(this).data('typelanguage');
                        var level = $(this).data('level');
                        var title = $(this).find(".title").text().trim().toLowerCase();
                        console.log(title.includes(searchValue));
                        // Kiểm tra nếu giá trị email chứa giá trị tìm kiếm và đáp ứng cả điều kiện lọc ngôn ngữ và cấp độ
                        if ((searchValue == "" || title.includes(searchValue)) &&
                            (selectedLanguageObject == "" || selectedLanguageObject == typeLanguage) &&
                            (selectedLevelObject == "" || selectedLevelObject == level)) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    });
                }
                //đóng thông báo 
                $(".content__content").on("click", ".turn_off_info", function() {
                    $(".content__content").children().last().remove();
                });
                //chỉnh sửa 
                //hàm khi nhấn chọn chỉnh sửa
                $('.content__table').on('click', '.button__edit', function() {
                    Question.title = "";
                    Question.typeLanguage = "";
                    Question.level = "";
                    Question.score = 10;
                    Question.time = 10;
                    for (let i = 0; i < Question.answers.length; i++) {
                        Question.answers[i].answerText = "";
                        Question.answers[i].score = false;
                    }
                    var selectedLanguageObjectToAddQuestion = "";
                    var selectedLevelObjectToAddQuestion = "";
                    var $listItem = $(this).closest('.list__item'); // Tìm phần tử gần nhất có class "list__item"
                    var title = $listItem.find('.title').text().trim(); // Lấy giá trị của phần tử có class "title"
                    var id = $listItem.find('.id_question').text().trim(); // Lấy giá trị của phần tử có class "id_question"
                    var answers = JSON.parse($listItem.find('.answer').text().trim()); // Lấy giá trị của phần tử có class "answer" và chuyển đổi từ chuỗi JSON sang đối tượng JavaScript
                    var time = $listItem.find('.time').text().trim(); // Lấy giá trị của phần tử có class "time"
                    var score = $listItem.find('.score').text().trim(); // Lấy giá trị của phần tử có class "score"var title = $listItem.find('.title').text(); // Lấy giá trị của phần tử có class "title"
                    var typeLanguage = $listItem.find('.typelanguage').text().trim(); // Lấy giá trị của phần tử có class "typeLanguage"
                    var level = $listItem.find('.level').text().trim(); // Lấy giá trị của phần tử có class "level"

                    console.log(typeLanguage + " " + level);
                    Question.title = title;
                    Question.typeLanguage = typeLanguage;
                    Question.level = level;
                    Question.time = time;
                    Question.score = score;
                    var selectedLanguageObjectToAddQuestion = typeLanguage;
                    var selectedLevelObjectToAddQuestion = level;
                    console.log(selectedLevelObjectToAddQuestion);
                    for (let i = 0; i < Question.answers.length; i++) {
                        Question.answers[i].answerText = answers[i].answerText;
                        Question.answers[i].score = answers[i].score;
                    }

                    $(".content__content").append(`
                                            <div id="wrapper__popup__add__quesion" class="open__popup">
                                                <div id="popup__add__quesion">
                                                    <div class="popup__title__info">
                                                        <div></div>
                                                        <p>Chỉnh Sửa Câu Hỏi</p>
                                                        <button class="close__msg" id="exit_add_question"><i class="fa-solid fa-xmark"></i></button>
                                                    </div>
                                                    <div class="popup__content__info">
                                                        <div class="info__detail__ques__1">
                                                            <label for="">Tiêu đề: </label>
                                                            <input name="title_question" type="text" placeholder="Nội dung câu hỏi" value="${Question.title}">
                                                        </div>
                                                        <div class="info__detail__ques__1">
                                                            <label for="">Ngôn Ngữ: </label>
                                                            <div class="language__option">
                                                                <select id="language_select_on_add">
                                                                    <option value="">Ngôn Ngữ</option>  <% typeLanguageLevels.forEach((typeLanguageLevel) => { %>
                                                                                    <option value=<%= typeLanguageLevel.typeLanguage %>><%= typeLanguageLevel.typeLanguage.toUpperCase() %></option>
                                                                                <% }) %>
                                                                </select>
                                                            </div>
                                                        </div>

                                                        <div class="info__detail__ques__1">
                                                            <label for="">Cấp độ: </label>
                                                            <div class="language__option">
                                                                <select id="level_select_on_add">
                                                                    <option value="">Level</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="info__detail__ques__1">
                                                            <label for="">Đáp Án: </label>
                                                            <div class="answer">
                                                                <div class="answer__1">
                                                                                <div class="ans_1">
                                                                                    <input type="text" name="answer" placeholder="Nội dung câu hỏi" value="${Question.answers[0].answerText}">
                                                                                    <input type="radio" name="score_answer" ${Question.answers[0].score ? "checked" : ""}>
                                                                                </div>

                                                                                <div class="ans_1">
                                                                                    <input type="text" name="answer" placeholder="Nội dung câu hỏi" value="${Question.answers[1].answerText}">
                                                                                    <input type="radio" name="score_answer" ${Question.answers[1].score ? "checked" : ""}>
                                                                                </div>
                                                                            </div>
                                                                            <div class="answer__1">
                                                                                <div class="ans_1">
                                                                                    <input type="text" name="answer" placeholder="Nội dung câu hỏi" value="${Question.answers[2].answerText}">
                                                                                    <input type="radio" name="score_answer" ${Question.answers[2].score ? "checked" : ""}>
                                                                                </div>

                                                                                <div class="ans_1">
                                                                                    <input type="text" name="answer" placeholder="Nội dung câu hỏi" value="${Question.answers[3].answerText}">
                                                                                    <input type="radio" name="score_answer" ${Question.answers[3].score ? "checked" : ""}>
                                                                                </div>
                                                                            </div>
                                                            </div>
                                                        </div>
                                                        <div class="set__options">
                                                            <div class="info__detail__ques__1">
                                                                <label for="">Điểm số </label>
                                                                <input type="text" value="${Question.score}" name="score" class="level">
                                                            </div>
                                                            <div class="info__detail__ques__1">
                                                                <label for="">Thời gian: </label>
                                                                <input type="text" value="${Question.time}" name="time" class="level">
                                                                <div class="time">
                                                                    <p class="level__text">Tính theo giây(s)</p>
                                                                    <p class="level__text">Mặc định 10 giây</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div style="display: flex; flex-direction: row; width: 100%; justify-content: end; align-items: center;">
                                                            <p class="validate_add_question" style="margin: 0; align-items: end;  padding-left: 10px; display: none; flex-direction: column; justify-content: flex-end; font-weight: 700;font-size: 1.3em; color: red;">
                                                            </p>
                                                            <div class="button__op1" style="margin: 0 !important;">
                                                                <button id="update" class="add_question">Cập Nhật</button>
                                                                <button class="cancel" id="exit_add_question1">Hủy</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>`);
                    $(`#language_select_on_add option[value="${Question.typeLanguage}"]`).prop('selected', true);
                    var typeLanguageLevels = JSON.parse('<%- JSON.stringify(typeLanguageLevels) %>');
                    var selectedLevels = typeLanguageLevels.find(function(typeLanguageLevel) {
                        return typeLanguageLevel.typeLanguage == selectedLanguageObjectToAddQuestion;
                    });

                    var levelSelect = $('#level_select_on_add');
                    levelSelect.empty();
                    // Thêm các option tương ứng với các level
                    selectedLevels.levels.forEach(function(level) {
                        var option = $('<option>', {
                            value: level,
                            text: level
                        });
                        if (level == selectedLevelObjectToAddQuestion) {
                            option.attr('selected', 'selected');
                        }
                        levelSelect.append(option);
                    });
                    $("#exit_add_question").on("click", function() {
                        $(".content__content").children().last().remove();
                    });
                    $("#exit_add_question1").on("click", function() {
                        $(".content__content").children().last().remove();
                    });
                    //sự kiện thêm câu hỏi
                    $(".add_question").on("click", function() {
                        Question.typeLanguage = selectedLanguageObjectToAddQuestion;
                        Question.level = selectedLevelObjectToAddQuestion;
                        var validate = "";
                        if (Question.title == "") {
                            validate += "thiếu tiêu đề câu hỏi";
                        }
                        if (Question.typeLanguage == "") {
                            if (validate != "")
                                validate += ", ";
                            validate += "chưa chọn loại ngôn ngữ";
                        }
                        if (Question.level == "") {
                            if (validate != "")
                                validate += ", ";
                            validate += "chưa chọn cấp độ";
                        }
                        var hasCorrectAnswer = Question.answers.some(function(answer) {
                            return answer.score == true;
                        });

                        if (!hasCorrectAnswer) {
                            if (validate != "")
                                validate += ", ";
                            validate += "chưa chọn đáp án đúng";
                        }
                        var hasEmptyAnswer = Question.answers.some(function(answer) {
                            return answer.answerText === "";
                        });

                        if (hasEmptyAnswer) {
                            if (validate != "")
                                validate += ", ";
                            validate += "hãy nhập nội dung cho tất cả câu trả lời";
                        }
                        if (validate != "") {
                            validate += ".";
                            $(".validate_add_question").css("display", "flex");
                            $(".validate_add_question").text(validate);
                            setTimeout(function() {
                                $(".validate_add_question").css("display", "none");
                            }, 2000);
                        } else {
                            console.log(Question);
                            $('.list__question').each(function() {
                                var firstLiValue = $(this).find('.list__item li:first-child').text().trim();
                                if (firstLiValue == id) {

                                    $(this).find('.answer').text(JSON.stringify(Question.answers));
                                    $(this).find('.time').text(Question.time);
                                    $(this).find('.score').text(Question.score);
                                    $(this).find('.title').text(Question.title);
                                    $(this).find('.typelanguage').text(Question.typeLanguage);
                                    $(this).find('.level').text(Question.level);

                                }
                            });

                            $(".content__content").children().last().remove();
                            $(".content__content").append(`
                            <div id="wrapper__popup__accept" class="open__popup">
                                <div id="popup__accept">
                                    <div class="popup__title">
                                        <img src="/images/admin/yes.png" alt="">
                                        <p>Thông Báo </p>
                                    </div>
                                    <div class="popup__content">
                                        <p>Chỉnh Sửa Thành Công!</p>

                                    </div>
                                </div>
                            </div>`);
                            setTimeout(function() {
                                $(".content__content").children().last().remove();
                            }, 1000);
                            $(".lds-ring").css("display", "flex");
                            $.ajax({
                                url: `/api/questions/update/${id}`,
                                type: "PUT",
                                headers: {
                                    "Content-Type": "application/json",
                                    Authorization: `Bearer ${token}`,
                                },
                                data: JSON.stringify(Question),
                                success: function(response) {
                                    $(".lds-ring").css("display", "none");
                                },
                                error: function(err) {
                                    $(".lds-ring").css("display", "none");
                                },
                            });
                        }
                    });
                    $('input[name="title_question"]').on('blur', function(e) {
                        var inputValue = $(this).val();
                        Question.title = inputValue;
                    });

                    $('input[name="answer"]').each(function(index) {

                        $(this).on('blur', function(e) {
                            var updatedValue = $(this).val();
                            console.log(index);
                            console.log(Question.answers);
                            Question.answers[index].answerText = updatedValue;
                        });
                    });
                    $('input[name="score_answer"]').on('change', function(e) {
                        var isChecked = $(this).prop('checked');
                        var selectedIndex = $('input[name="score_answer"]').index(this);
                        console.log(selectedIndex);
                        $('input[name="score_answer"]').each(function(index) {
                            Question.answers[index].score = (index === selectedIndex) ? isChecked : false;
                        });
                    });
                    //chỉ cho nhập số vào input điểm số và giới hạn điểm số từ khoảng 10 đến 200
                    $('input[name="score"].level').on('blur', function(e) {
                        var inputValue = parseInt($(this).val());
                        // Xóa các ký tự không phải số
                        if (isNaN(inputValue)) {
                            inputValue = 10;
                            Question.score = 10;
                        } else {
                            // Kiểm tra giới hạn giá trị
                            inputValue = Math.min(Math.max(inputValue, 10), 200);
                            Question.score = inputValue;
                        }
                        $(this).val(inputValue);
                    });
                    //chỉ cho nhập số vào input thời gian và giới hạn thời gian từ khoảng 10 đến 180
                    $('input[name="time"]').on('blur', function(e) {
                        var inputValue = parseInt($(this).val());
                        // Xóa các ký tự không phải số
                        if (isNaN(inputValue)) {
                            inputValue = 10;
                            Question.time = 10;
                        } else {
                            // Kiểm tra giới hạn giá trị
                            inputValue = Math.min(Math.max(inputValue, 10), 180);
                            Question.time = inputValue;
                        }
                        $(this).val(inputValue);
                    });
                    //chọn cấp độ ở phần thêm câu hỏi
                    $('#level_select_on_add').change(function() {
                        var selectedLanguage = $(this).val();
                        selectedLevelObjectToAddQuestion = selectedLanguage;
                        console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                    });

                    //chọn ngôn ngữ
                    $('#language_select_on_add').change(function() {
                        var selectedLanguage = $(this).val();
                        var typeLanguageLevels = JSON.parse('<%- JSON.stringify(typeLanguageLevels) %>');
                        var selectedLevels = typeLanguageLevels.find(function(typeLanguageLevel) {
                            return typeLanguageLevel.typeLanguage == selectedLanguage;
                        });
                        if (selectedLevels) {
                            selectedLanguageObjectToAddQuestion = selectedLanguage;
                            selectedLevelObjectToAddQuestion = "1";
                            var levelSelect = $('#level_select_on_add');
                            levelSelect.empty();
                            console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                            // Thêm các option tương ứng với các level
                            selectedLevels.levels.forEach(function(level) {
                                levelSelect.append($('<option>', {
                                    value: level,
                                    text: level
                                }));
                            });
                        } else {
                            selectedLanguageObjectToAddQuestion = "";
                            selectedLevelObjectToAddQuestion = "";
                            var levelSelect = $('#level_select_on_add');
                            levelSelect.empty();
                            levelSelect.append($('<option>', {
                                value: "",
                                text: "Level"
                            }));
                            console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                        }
                    });
                });
                //xóa câu hỏi
                $('.content__table').on('click', '.button__del', function() {
                    var $listItem = $(this).closest('.list__item'); // Tìm phần tử gần nhất có class "list__item"
                    var title = $listItem.find('.title').text().trim(); // Lấy giá trị của phần tử có class "title"
                    var id = $listItem.find('.id_question').text().trim(); // Lấy giá trị của phần tử có class "id_question"
                    var answers = JSON.parse($listItem.find('.answer').text().trim()); // Lấy giá trị của phần tử có class "answer" và chuyển đổi từ chuỗi JSON sang đối tượng JavaScript
                    var time = $listItem.find('.time').text().trim(); // Lấy giá trị của phần tử có class "time"
                    var score = $listItem.find('.score').text().trim(); // Lấy giá trị của phần tử có class "score"var title = $listItem.find('.title').text(); // Lấy giá trị của phần tử có class "title"
                    var typeLanguage = $listItem.find('.typelanguage').text().trim(); // Lấy giá trị của phần tử có class "typeLanguage"
                    var level = $listItem.find('.level').text().trim(); // Lấy giá trị của phần tử có class "level"
                    $(".content__content").append(`<div id="delete_infor" class="open__popup">
                    <div id="popup">
                        <div class="popup__title ">
                            <p>Thông báo </p>
                        </div>
                        <div class="popup__content ">
                            <p>Bạn có chắc muốn xóa câu hỏi:</p>
                            <ul class="info__del ">
                                <li>Ngôn ngữ : ${typeLanguage}</li>
                                <li>Level:  ${level}</li>
                            </ul>
                            <div class="popup__op ">
                                <button type="button " id="accept_delete">Xác nhận</button>
                                <button type="button " id="exit_delete">Hủy</button>
                            </div>
                        </div>
                    </div>
                </div>`);
                    $("#exit_delete").on("click", function() {
                        $(".content__content").children().last().remove();
                    })
                    $("#accept_delete").on("click", function() {
                        $(".lds-ring").css("display", "flex");
                        $.ajax({
                            url: `/api/questions/delete/${id}`,
                            type: "DELETE",
                            headers: {
                                "Authorization": "Bearer " + token,
                            },
                            success: function(response) {
                                $(".lds-ring").css("display", "none");
                                $('.list__question').each(function() {

                                    var firstLiValue = $(this).find('.list__item li:first-child').text().trim();
                                    if (firstLiValue == id) {
                                        $(this).remove();
                                    }
                                    $(".content__content").children().last().remove();
                                    $(".content__content").append(`
                                                    <div id="wrapper__popup__accept" class="infor-success open__popup ">
                                                        <div id="popup__accept">
                                                            <div class="popup__title">
                                                                <img src="/images/admin/yes.png" alt="">
                                                                <p>Thông Báo </p>
                                                            </div>
                                                            <div class="popup__content">
                                                                <p class="content-info" style="display: flex; justify-content: center;">Xóa Thành Công</p>
                                                                <div class="popup__op">
                                                                    <button type="button" id="exit-info1" class="turn_off_info">Thoát</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>`);

                                });
                            },
                            error: function(xhr, status, error) {
                                $(".lds-ring").css("display", "none");
                                $(".content__content").children().last().remove();
                                $(".content__content").append(`
                                                    <div id="wrapper__popup__accept" class="infor-success open__popup">
                                                        <div id="popup__accept">
                                                            <div class="popup__title">
                                                                <img src="/images/admin/error.png" alt="">
                                                                <p>Thông Báo </p>
                                                            </div>
                                                            <div class="popup__content">
                                                                <p class="content-info" style="display: flex; justify-content: center;">Xóa thất bại.</p>
                                                                <div class="popup__op">
                                                                    <button type="button" id="exit-info1" class="turn_off_info">Thoát</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>`);
                            }
                        });
                    })
                });
            });
        </script>
</body>

</html>